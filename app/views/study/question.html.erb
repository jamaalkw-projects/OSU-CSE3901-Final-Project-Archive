<!-- question.html.erb - Project 6
    Created 7/22/24 by Nicholas Colacarro
    Edited 7/23/24 by Nicholas Colacarro: Added all choices shuffled with button to submit. 
    Edited 7/26/24 by Nicholas Colacarro: Added jQuery code to make buttons the correct colors. 
    Edited 7/27/24 by Nicholas Colacarro: Made choices be listed out with letters. 
    Edited 7/27/24 by Hengkai Zheng: Added radio buttons for choices, confirmation button, and feedback logic. -->

<div class="study-container">
  <div class="question-box">
<h1>Question <%= @question_index %> of <%= @total_questions %></h1>
<p><%= @question.content %></p>
  </div>

<!-- Use the stored order of choices from the session -->
  <div class="answer-box">
<%= form_with url: submit_answer_path, method: :post, local: true do %>
  <div class="choices">
    <% @choices.each do |choice| %>
      <div>
        <%= check_box_tag 'selected_choices[]', choice, false, id: choice %>
        <%= label_tag choice %>
      </div>
    <% end %>
  </div>
  <%= hidden_field_tag :question_id, @question.id %>
  <%= hidden_field_tag :quiz_id, @question.quiz_id %>
  <%= submit_tag 'Confirm', class: 'btn btn-primary' %>
<% end %>
</div>
<% if flash[:correct] %>
  <p class="alert alert-success"><%= flash[:correct] %></p>
<% elsif flash[:incorrect] %>
  <p class="alert alert-danger"><%= flash[:incorrect] %></p>
<% end %>

<!-- Buttons for previous and next questions. -->
 <div class="navigation-buttons">
    <%= link_to 'Previous', previous_question_path(@question, quiz_id: @question.quiz_id), class: 'btn btn-primary' %>
    <%= link_to 'Next', next_question_path(@question, quiz_id: @question.quiz_id), class: 'btn btn-primary' %>
</div>
</div>

<!-- jQuery code to change button colors. -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    $('.answer-form').on('submit', function(event) {
      event.preventDefault();

      var formData = $(this).serializeArray();
      var selectedChoice = formData.find(field => field.name === 'selected_choice').value;
      var choiceCorrect = $(this).find('input[name="question_id"]').data('choiceCorrect') === true;

      var $submitButton = $(this).find('input[type="submit"]');
      $submitButton.toggleClass('correct', choiceCorrect);
      $submitButton.toggleClass('incorrect', !choiceCorrect);
    });
  });
</script>



